import{k as _e,l as me,F as V,i as ve,m as fe,j as S,b as m}from"./index-11d2d6b3.js";import{o as i,m as h,p as a,g as ye,h as p,j as he,k as ge,D as o,x as v,J as Ie,K as Ee,l as t,c as N,C as j,B as P,n as Le,t as O,L as q,ap as xe,aq as De,av as be,O as we,P as Te,H as Ce,az as Ve,aa as Se,a5 as Ne,N as f,aw as Oe,at as Ae}from"./vendor-a962175c.js";import{u as ke,c as Fe,b as Pe,e as Re,d as Be}from"./index-8a0f43b8.js";const je={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function qe(A,d){return i(),h("svg",je,d[0]||(d[0]=[a("path",{fill:"currentColor",d:"M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504L738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512L828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496L285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512L195.2 285.696a64 64 0 0 1 0-90.496"},null,-1)]))}const Me={name:"ep-close-bold",render:qe},Ue={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function ze(A,d){return i(),h("svg",Ue,d[0]||(d[0]=[a("path",{fill:"currentColor",d:"M77.248 415.04a64 64 0 0 1 90.496 0l226.304 226.304L846.528 188.8a64 64 0 1 1 90.56 90.496l-543.04 543.04l-316.8-316.8a64 64 0 0 1 0-90.496"},null,-1)]))}const He={name:"ep-select",render:ze},$e={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function Qe(A,d){return i(),h("svg",$e,d[0]||(d[0]=[a("path",{fill:"currentColor",d:"M832 512a32 32 0 1 1 64 0v352a32 32 0 0 1-32 32H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h352a32 32 0 0 1 0 64H192v640h640z"},null,-1),a("path",{fill:"currentColor",d:"m469.952 554.24l52.8-7.552L847.104 222.4a32 32 0 1 0-45.248-45.248L477.44 501.44l-7.552 52.8zm422.4-422.4a96 96 0 0 1 0 135.808l-331.84 331.84a32 32 0 0 1-18.112 9.088L436.8 623.68a32 32 0 0 1-36.224-36.224l15.104-105.6a32 32 0 0 1 9.024-18.112l331.904-331.84a96 96 0 0 1 135.744 0z"},null,-1)]))}const Xe={name:"ep-edit",render:Qe},Ke={class:"p-7 bg-default"},Ge={class:"flex justify-between"},Je={class:"flex items-center flex-1 w-0"},We={class:"flex items-center flex-wrap"},Ye={key:0,class:"flex items-center mt-2"},Ze={class:"mt-2"},et={class:"mt-6 pl-3"},tt={class:"text-regular"},st={class:"text-primary font-semibold mt-2 text-lg"},lt={key:0},ot={class:"mt-4"},at={class:"text-regular"},nt={class:"p-3"},ut=ye({__name:"index",setup(A){const d=f(()=>m(()=>import("./EventRate-0b14c045.js"),["assets/EventRate-0b14c045.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css"])),M=f(()=>m(()=>import("./EventInfo-36a22999.js"),["assets/EventInfo-36a22999.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css"])),U=f(()=>m(()=>import("./EventHistory-cfe72d44.js"),["assets/EventHistory-cfe72d44.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css","assets/index-8a0f43b8.js","assets/EventHistory-efe26b0c.css"])),z=f(()=>m(()=>import("./EventUpload-90517ae4.js"),["assets/EventUpload-90517ae4.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css"])),H=f(()=>m(()=>import("./EventRemark-68e954f5.js"),["assets/EventRemark-68e954f5.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css","assets/EventRemark-c59d5f5e.css"])),$=f(()=>m(()=>import("./EventSearch-703a4949.js"),["assets/EventSearch-703a4949.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css"])),Q=f(()=>m(()=>import("./EventSync-6f3445ce.js"),["assets/EventSync-6f3445ce.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css","assets/chatEnum-07464a66.js"])),X=f(()=>m(()=>import("./CommonQuestionModal-a90474d1.js"),["assets/CommonQuestionModal-a90474d1.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css"])),K=f(()=>m(()=>import("./LiveSyncActivityModal-302d201d.js"),["assets/LiveSyncActivityModal-302d201d.js","assets/index-11d2d6b3.js","assets/vendor-a962175c.js","assets/vendor-9f745663.css","assets/index-b7f84b08.css"])),u=xe(),G=De(),J=_e(),{createMessage:W}=fe();let R=0;const c=p([]),E=p({}),g=p(!1),k=p([]),w=p(!1),T=p(!1),I=p(!1),L=p({}),F=p(!1),x=p(!1),Y=async()=>{I.value=!I.value,g.value=!0,await Promise.all(c.value.map(async e=>await re(e))),g.value=!1,L.value={OperationType:me.EDIT,ProjectID:Number(u.query.projectId),ID:Number(u.query.id),Name:E.value[V.TITLE].value||"",LastUpdateNo:R+1}},Z=async()=>{F.value&&(x.value=!0,await ke(L.value),x.value=!1),W.success("修改成功"),G.back()},ee=e=>{F.value=!0,L.value.Fields=te(e)},te=e=>{let s=[];for(const n in e)s.push({FieldID:Number(n),Value:e[n]});return s},se=()=>{w.value=!0},le=()=>{T.value=!0},oe=()=>{I.value=!I.value,F.value=!1},ae=e=>(e==null?void 0:e.fieldTypeID)==S.DROPDOWN_LIST||(e==null?void 0:e.fieldTypeID)==S.CHECKBOX||(e==null?void 0:e.fieldTypeID)==S.MULTIPLE_SELECTION_LISTBOX||(e==null?void 0:e.fieldTypeID)==S.COMBOBOX,ne=async e=>{const s=await Be({projectId:Number(u.query.projectId),crntStatusID:e});k.value=s,g.value=!1},ie=async e=>{const s=await Re({projectId:Number(u.query.projectId),itemId:Number(u.query.id),fieldIds:e});R=s.lastUpdateNo;let n=0;s.fields.map(l=>{l.id==V.CURRENT_STATUS&&(n=l.dbValue),E.value[l.id]={value:l.value||"",dbValue:l.dbValue||""}}),n||(n=s.oldStatusID),await ne(n)},re=async e=>{if(ae(e)){const s=await Fe(Number(u.query.projectId),e.fieldID);e.listChoice=s}return e},B=async()=>{if(!u.query.projectId)return;g.value=!0;const e=await Pe({projectId:Number(u.query.projectId)}),s=e.stmartIssueTypePages.filter(l=>l.incidentTypeID==1).map(l=>l.guiPageID),n=e.fieldsOnPage.filter(l=>s.includes(l.guiPageID));for(let l=0;l<n.length;l++){const _=n[l],D=e.customFields.find(b=>b.fieldID==_.uiFieldID),C=e.sysFields.find(b=>b.fieldID==_.uiFieldID);let y=D||C;!C&&!D||(y.width=_.width,y.height=_.height,y.tabOrder=_.tabOrder,c.value=[...c.value,y])}c.value=be(c.value,"fieldID"),c.value.sort((l,_)=>l.tabOrder-_.tabOrder),c.value=c.value.filter(l=>l.visibleToCustomer>ve.HIDDEN),await ie(c.value.map(l=>l.fieldID).join(","))};return he(()=>u.query.id,()=>{B()}),ge(()=>{B()}),(e,s)=>{const n=we,l=Oe,_=Ae,D=Te,C=Xe,y=Ce,b=He,de=Me,ue=Ve,ce=Se;return i(),h("div",null,[a("div",Ke,[a("div",Ge,[a("div",Je,[o(D,{animated:"",loading:t(g)},{template:v(()=>[o(n,{variant:"button",class:"mr-2",style:{height:"28px",width:"81px"}}),o(n,{variant:"button",class:"mr-2",style:{height:"28px",width:"81px"}}),o(n,{variant:"button",style:{height:"28px",width:"81px"}})]),default:v(()=>[a("div",We,[(i(!0),h(Ie,null,Ee(t(k),r=>(i(),N(l,{content:`目标状态“${r.nextStatusName}”`,placement:"top",key:r.statusId},{default:v(()=>[a("div",{class:Ne(["mt-2 px-5 py-1 border-2 w-fit rounded mr-2 cursor-pointer",r.nextStatusIfClosed>0?"border-[#FA6400] text-[#FA6400]":"border-theme text-theme"])},O(r.transitionName),3)]),_:2},1032,["content"]))),128)),t(J).getEnableINT?(i(),h("div",Ye,[t(k).length?(i(),N(_,{key:0,class:"!h-5",direction:"vertical"})):j("",!0),a("div",{onClick:se,class:"mx-2 px-5 py-1 border-2 w-fit rounded cursor-pointer border-theme text-theme bg-[var(--el-color-primary-light-9)]"}," Ask Bot "),a("div",{onClick:le,class:"mx-2 px-5 py-1 border-2 w-fit rounded cursor-pointer border-[var(--el-color-success)] text-[var(--el-color-success)] bg-[var(--el-color-success-light-9)]"}," LiveSync Activity ")])):j("",!0)])]),_:1},8,["loading"])]),a("view",Ze,[t(I)?(i(),h("view",{key:1,class:"flex justify-end",style:Le({width:t(x)?"240px":"200px"})},[o(ue,{class:"whitespace-nowrap"},{default:v(()=>[o(y,{type:"default",loading:t(x),onClick:Z},{default:v(()=>[o(b,{class:"mr-1"}),s[4]||(s[4]=P(" Submit "))]),_:1},8,["loading"]),o(y,{type:"default",loading:t(x),onClick:oe},{default:v(()=>[o(de,{class:"mr-1"}),s[5]||(s[5]=P(" Cancel "))]),_:1},8,["loading"])]),_:1})],4)):(i(),N(y,{key:0,type:"default",onClick:Y},{default:v(()=>[o(C,{class:"mr-1"}),s[3]||(s[3]=P(" Edit "))]),_:1}))])]),a("div",et,[a("div",null,[s[6]||(s[6]=a("span",{class:"text-placeholder mr-2"},"事件ID:",-1)),a("span",tt,"#"+O(t(u).query.id),1)]),o(D,{loading:t(g),animated:"",throttle:500},{template:v(()=>[o(n,{class:"mt-2"}),o(n,{style:{width:"20%"}})]),default:v(()=>{var r;return[a("div",st,[t(I)?(i(),N(ce,{key:1,modelValue:t(L).Name,"onUpdate:modelValue":s[0]||(s[0]=pe=>t(L).Name=pe),placeholder:"请输入标题"},null,8,["modelValue"])):(i(),h("span",lt,O(((r=t(E)[t(V).TITLE])==null?void 0:r.value)||""),1))]),a("div",ot,[s[7]||(s[7]=a("span",{class:"text-placeholder mr-1"},"当前状态:",-1)),a("span",at,O(t(E)[t(V).CURRENT_STATUS]||""),1)])]}),_:1},8,["loading"])])]),a("div",nt,[o(t(d)),o(t(M),{fieldList:t(c),fieldsValue:t(E),isLoading:t(g),isEdit:t(I),onChange:ee,class:"mt-3"},null,8,["fieldList","fieldsValue","isLoading","isEdit"]),o(t(U),{class:"mt-3"}),o(t(z),{class:"mt-3"}),o(t(H),{class:"mt-3"}),o(t($),{class:"mt-3"}),o(t(Q),{class:"mt-3"})]),o(t(X),{modelValue:t(w),"onUpdate:modelValue":s[1]||(s[1]=r=>q(w)?w.value=r:null)},null,8,["modelValue"]),o(t(K),{modelValue:t(T),"onUpdate:modelValue":s[2]||(s[2]=r=>q(T)?T.value=r:null)},null,8,["modelValue"])])}}});export{ut as default};
