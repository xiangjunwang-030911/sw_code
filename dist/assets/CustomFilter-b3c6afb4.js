import{h as n,U as F,i as S,j as g,I as Y,o,m as f,D as c,x as s,aK as H,l as E,aL as I,p as W,J as y,K as $,c as r,C as j,aM as P,B as D,t as z,ai as J,H as G,al as Q,am as X,aa as Z,aN as ee,ah as le,as as ae,aO as te}from"./vendor-a962175c.js";import{m as ue}from"./index-11d2d6b3.js";const oe={class:"flex items-center"},ve={__name:"CustomFilter",props:{fields:{required:!0,type:Array}},emits:["change"],setup(w,{emit:N}){const x=w,{createMessage:L}=ue(),M=N,C=n(null),h=n(null),p=n(!1),v=n([{label:"等于",value:"$eq"},{label:"等于(大小写敏感)",value:"$eqi"},{label:"不等于",value:"$ne"},{label:"不等于(大小写敏感)",value:"$nei"},{label:"为空",value:"$null"},{label:"不为空",value:"$notNull"},{label:"小于",value:"$lt"},{label:"小于等于",value:"$lte"},{label:"大于",value:"$gt"},{label:"大于等于",value:"$gte"},{label:"包含",value:"$contains"},{label:"包含(大小写敏感)",value:"$containsi"},{label:"不包含",value:"$notContains"},{label:"不包含(大小写敏感)",value:"$notContainsi"},{label:"开始于",value:"$startsWith"},{label:"开始于(大小写敏感)",value:"$startsWithi"},{label:"结束于",value:"$endsWith"},{label:"结束于(大小写敏感)",value:"$endsWithi"}]),k=F(v.value),i=n(v.value[0]),t=n(x.fields[0]),u=n(""),d=n([]),m=S(()=>{const a=["$null","$notNull"].includes(i.value.value);return a&&(u.value=""),!a}),T=()=>{var a,l;if(!((a=t.value)!=null&&a.value&&((l=i.value)!=null&&l.value))){L.error("字段和条件不能为空");return}d.value.push({fieldLabel:t.value.label,fieldValue:t.value.value,fieldType:t.value.type,operatorLabel:i.value.label,operatorValue:i.value.value,keyword:u.value,list:t.value.list,renderKeyword:t.value.render?t.value.render(u.value,t.value.value):null,isRelation:t.value.isRelation,id:new Date().getTime()}),p.value=!1,u.value=""},U=a=>{d.value=d.value.filter(l=>l.id!==a.id)},B=a=>a.fieldType==Date?J(a.keyword).format("YYYY-MM-DD HH:mm:ss"):a.fieldType==Array?a.list.find(l=>l.value==a.keyword).label:a.keyword;return g(()=>t.value,()=>{var a;if(t.value.type==Date||t.value.type==Number){const l=["$startsWith","$startsWithi","$endsWith","$endsWithi","$contains","$containsi","$notContains","$notContainsi"];v.value=k.filter(b=>!l.includes(b.value))}else t.value.type==Array?v.value=[{label:"等于",value:"$eq"}]:(a=t.value.customOperators)!=null&&a.length?v.value=k.filter(l=>t.value.customOperators.includes(l.value)):v.value=[...k];u.value=""},{deep:!0,immediate:!0}),g(()=>d.value,()=>{M("change",d.value.map(a=>({...a,keyword:a.renderKeyword?a.renderKeyword:a.keyword})))},{deep:!0}),Y(C,a=>p.value=!1,{ignore:[h]}),(a,l)=>{const b=G,V=Q,_=X,K=Z,O=ee,R=le,A=ae,q=te;return o(),f("div",oe,[c(A,{visible:p.value,placement:"bottom-start","show-arrow":!1,width:"auto"},{reference:s(()=>[c(b,{onClick:l[0]||(l[0]=H(e=>p.value=!p.value,["stop"])),icon:E(I),class:"w-[80px]",ref_key:"ignoreElRef",ref:h},{default:s(()=>l[7]||(l[7]=[W("span",null,"过滤器",-1)])),_:1},8,["icon"])]),default:s(()=>[W("div",{class:"flex flex-col",ref_key:"popoverWrapperRef",ref:C},[c(_,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),teleported:!1,"value-key":"value",placeholder:"",filterable:"",onChange:a.handleChangeField},{default:s(()=>[(o(!0),f(y,null,$(w.fields,e=>(o(),r(V,{key:e.value,label:e.label,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),c(_,{modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value=e),placeholder:"",teleported:!1,class:"my-3",filterable:""},{default:s(()=>[(o(!0),f(y,null,$(v.value,e=>(o(),r(V,{key:e.value,"value-key":"value",label:e.label,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),m.value&&(t.value.type==String||t.value.type==Object)?(o(),r(K,{key:0,modelValue:u.value,"onUpdate:modelValue":l[3]||(l[3]=e=>u.value=e),placeholder:""},null,8,["modelValue"])):m.value&&t.value.type==Number?(o(),r(O,{key:1,class:"w-full",modelValue:u.value,"onUpdate:modelValue":l[4]||(l[4]=e=>u.value=e),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])):m.value&&t.value.type==Date?(o(),r(R,{key:2,class:"w-full",type:"datetime",clearable:"",modelValue:u.value,"onUpdate:modelValue":l[5]||(l[5]=e=>u.value=e),teleported:!1,placeholder:""},null,8,["modelValue"])):m.value&&t.value.type==Array?(o(),r(_,{key:3,clearable:"",teleported:!1,modelValue:u.value,"onUpdate:modelValue":l[6]||(l[6]=e=>u.value=e),placeholder:""},{default:s(()=>[(o(!0),f(y,null,$(t.value.list,e=>(o(),r(V,{key:e.value,value:e.value,label:e.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):j("",!0),c(b,{class:"mt-3",type:"primary",icon:E(P),onClick:T},{default:s(()=>l[8]||(l[8]=[D("添加过滤器")])),_:1},8,["icon"])],512)]),_:1},8,["visible"]),(o(!0),f(y,null,$(d.value,e=>(o(),r(q,{key:e.value,size:"large",class:"mx-1",closable:"",type:"",onClose:ne=>U(e)},{default:s(()=>[D(z(`${e.fieldLabel} ${e.operatorLabel} ${B(e)}`),1)]),_:2},1032,["onClose"]))),128))])}}};export{ve as default};
