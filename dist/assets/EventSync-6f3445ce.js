import{r as g,u as C,G as I,H as N,D as M}from"./index-11d2d6b3.js";import{M as _,a as b,b as D,c as l}from"./chatEnum-07464a66.js";import{g as S,ap as R,h as d,i as T,bb as w,k as h,o as E,c as q,x as p,p as s,D as A,l as f,N as B}from"./vendor-a962175c.js";function U(n,t="modal"){return g.get({url:"/api/WebConversation/RecentComments",params:n},{errorMessageMode:t})}function j(n,t="modal"){return g.post({url:"/api/WebConversation/AddComment",params:n},{errorMessageMode:t})}const G=S({__name:"EventSync",setup(n){const t=B(),r=R(),u=C(),o=d([]),m=d(),x=T(()=>I(w(o.value,["sequenceID","orderID"]).map(e=>({from:_.HUMMAN,type:e.role,content:e.desc,createdTime:Number(e.createdTime),senderName:e.creator,contentType:b.COMMON,status:e.status})))),v=async()=>{let e=await U({projectId:Number(r.query.projectId),itemId:Number(r.query.id),beforeCommentID:"",limit:100});o.value=e},y=async e=>{var c;const a=N();o.value.push({id:a,role:D.OUTGOING,desc:e,creator:u.getUserInfo.fName+u.getUserInfo.lName,createdTime:String(new Date().getTime()),status:l.IN_PROGRESS}),(c=m.value)==null||c.scrollToButtom(),await j({projectID:Number(r.query.projectId),itemID:Number(r.query.id),desc:e,clearRequestFlag:!1,fileID:0}),o.value.forEach(i=>{i.id===a&&(i.status=l.SENT)})};return h(()=>{v()}),(e,a)=>{const c=M;return E(),q(c,null,{title:p(()=>a[0]||(a[0]=[s("div",{class:"flex items-center justify-between"},[s("span",null,"对话"),s("div",{class:"flex items-center mr-4"},[s("div",{class:"flex items-center mr-8"},[s("span",{class:"text-xs text-regular mr-2"},"新消息"),s("span",{class:"text-[22px] font-medium"},"3")]),s("div",{class:"flex items-center"},[s("span",{class:"text-xs text-regular mr-2"},"新音想"),s("span",{class:"text-[22px] font-medium"},"1")])])],-1)])),default:p(()=>[A(f(t),{ref_key:"messagesViewRef",ref:m,class:"h-[400px] py-3",groupedConversation:f(x),isShowActivity:!1,onSend:y},null,8,["groupedConversation"])]),_:1})}}});export{G as default};
